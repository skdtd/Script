<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>颜色设置</title>
</head>

<body>
    <div>
        <table style="text-align: center;" id="setting">
            <tr>
                <th>方向</th>
                <th>字体颜色</th>
                <th>字体背景</th>
            </tr>
            <tr id="tl">
                <td>上左</td>
                <td><input type="color"></td>
                <td><input type="color"></td>
            </tr>
            <tr id="tm">
                <td>上中</td>
                <td><input type="color"></td>
                <td><input type="color"></td>
            </tr>
            <tr id="tr">
                <td>上右</td>
                <td><input type="color"></td>
                <td><input type="color"></td>
            </tr>
            <tr id="bl">
                <td>下左</td>
                <td><input type="color"></td>
                <td><input type="color"></td>
            </tr>
            <tr id="bm">
                <td>下中</td>
                <td><input type="color"></td>
                <td><input type="color"></td>
            </tr>
            <tr id="br">
                <td>下右</td>
                <td><input type="color"></td>
                <td><input type="color"></td>
            </tr>
        </table>
    </div>
</body>
<script>
    var server_ip = 'localhost'
    var server_port = 8899
    function ajax_method(url, data, method, success, async) {
        var ajax = new XMLHttpRequest()
        url = 'http://' + server_ip + ':' + server_port + '/' + url
        ajax.open(method, url, async)
        ajax.onreadystatechange = function () {
            if (ajax.readyState == 4 && ajax.status == 200) {
                if (success){
                    success(ajax.responseText)
                }
            } else {
                // nothing todo
            }
        }
        if (method.toUpperCase() == 'GET') {
            if (data) {
                url += '?'
                url += data
            }
            ajax.send()
        } else if (method.toUpperCase() == 'POST'){
            ajax.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
            if (data) {
                ajax.send(data)
            } else {
                ajax.send()
            }
        } else {
            console.log('Unsupported method')
        }
    }

    function init() {
        // 为每个input添加默认选中值
        // 同步请求从服务器获取之前保存的颜色,加载为预显示颜色
        obj = {"tl":{"font":"#00FF00","bg":"#FF0000"},"tm":{"font":"#00FF00","bg":"#FF0000"},"tr":{"font":"#00FF00","bg":"#FF0000"},"bl":{"font":"#00FF00","bg":"#FF0000"},"bm":{"font":"#00FF00","bg":"#FF0000"},"br":{"font":"#00FF00","bg":"#FF0000"}}
        ajax_method('color', null, 'GET', (resp) =>{
            obj = JSON.parse(resp)
            for (idx in obj) {
                var elm = document.getElementById(obj[idx][0])
                var inputs = elm.getElementsByTagName('input')
                inputs[0].value = obj[idx][1]
                inputs[1].value = obj[idx][2]
            }
        })
        
        // 为setting中的每个input添加事件
        var setting = document.getElementById('setting')
        var inputs = setting.getElementsByTagName('input')
        for (let i = 0; i < inputs.length; i++) {
            inputs[i].onchange = () => {
                // 数值修改时向服务器发起异步请求
                var tr = document.getElementById(inputs[i].parentElement.parentElement.id)
                var ins = tr.getElementsByTagName('input')
                var data = 'alias='+inputs[i].parentElement.parentElement.id+"&font="+ins[0].value+"&bg="+ins[1].value
                ajax_method('color', data, 'POST', null)
            }
        }
    }
    init()
</script>

</html>