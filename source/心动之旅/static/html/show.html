<html>

<head>
    <style>
        * {
            margin: 0;
            padding: 0;
            border: 0;
        }

        table {
            border-collapse: collapse;
        }
    </style>
    <meta http-equiv="Content-Security-Policy">
    <script src="{{ url_for('static',filename='js/common.js') }}"></script>
    <script src="{{ url_for('static',filename='js/show_page.js') }}"></script>
    <title>展示</title>
</head>

<body>
<table cellspacing="0" cellpadding="0">
    <tbody id="data_count">
    </tbody>
</table>
<table cellspacing="0" cellpadding="0">
    <tbody id="container" style="display: flex; flex-direction: row">
    </tbody>
</table>
<img id="pic"/>
<div id='ad'></div>
</body>

<script>
    function ajax_method(url, data, method, success, async) {
        const ajax = new XMLHttpRequest();
        ajax.open(method, url, async)
        ajax.onreadystatechange = function () {
            if (ajax.readyState === 4 && ajax.status === 200) {
                if (success) {
                    success(ajax.responseText)
                }
            } else {
                // nothing todo
            }
        }
        if (method.toUpperCase() === 'GET') {
            ajax.send()
        } else if (method.toUpperCase() === 'POST') {
            if (data) {
                if (data.constructor.name !== 'FormData') {
                    ajax.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
                }
                ajax.send(data)
            } else {
                ajax.send()
            }
        } else {
            console.log('Unsupported method')
        }
    }

    function update() {
        // 统计区
        // 数据区
        ajax_method("124.222.214.146/pull", null, 'GET', (resp) => {
            const obj = JSON.parse(resp);
            console.log(obj)
            // 数据区
            add_data(document.querySelector("#container"), obj.data[0])
        })
    }

    // 定时器
    setInterval(function () {
        update()
    }, 5000);
</script>

</html>